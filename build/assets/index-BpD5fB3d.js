import{w as F}from"./index-7Y1qgM2T.js";function U(s,e){s.indexOf(e)===-1&&s.push(e)}function x(s,e){const t=s.indexOf(e);t>-1&&s.splice(t,1)}function X([...s],e,t){const n=e<0?s.length+e:e;if(n>=0&&n<s.length){const i=t<0?s.length+t:t,[a]=s.splice(e,1);s.splice(i,0,a)}return s}const q=s=>s;class D{constructor(){this.subscriptions=[]}add(e){return U(this.subscriptions,e),()=>x(this.subscriptions,e)}notify(e,t,n){const i=this.subscriptions.length;if(i)if(i===1)this.subscriptions[0](e,t,n);else for(let a=0;a<i;a++){const o=this.subscriptions[a];o&&o(e,t,n)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}function L(s,e){return e?s*(1e3/e):0}const f=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],w={value:null,addProjectionMetrics:null};function N(s,e){let t=new Set,n=new Set,i=!1,a=!1;const o=new WeakSet;let l={delta:0,timestamp:0,isProcessing:!1},h=0;function g(r){o.has(r)&&(d.schedule(r),s()),h++,r(l)}const d={schedule:(r,A=!1,y=!1)=>{const p=y&&i?t:n;return A&&o.add(r),p.has(r)||p.add(r),r},cancel:r=>{n.delete(r),o.delete(r)},process:r=>{if(l=r,i){a=!0;return}i=!0,[t,n]=[n,t],t.forEach(g),e&&w.value&&w.value.frameloop[e].push(h),h=0,t.clear(),i=!1,a&&(a=!1,d.process(r))}};return d}const O=40;function j(s,e){let t=!1,n=!0;const i={delta:0,timestamp:0,isProcessing:!1},a=()=>t=!0,o=f.reduce((c,u)=>(c[u]=N(a,e?u:void 0),c),{}),{setup:l,read:h,resolveKeyframes:g,preUpdate:d,update:r,preRender:A,render:y,postRender:P}=o,p=()=>{const c=F.useManualTiming?i.timestamp:performance.now();t=!1,F.useManualTiming||(i.delta=n?1e3/60:Math.max(Math.min(c-i.timestamp,O),1)),i.timestamp=c,i.isProcessing=!0,l.process(i),h.process(i),g.process(i),d.process(i),r.process(i),A.process(i),y.process(i),P.process(i),i.isProcessing=!1,t&&e&&(n=!1,s(p))},S=()=>{t=!0,n=!0,i.isProcessing||s(p)};return{schedule:f.reduce((c,u)=>{const T=o[u];return c[u]=(E,b=!1,R=!1)=>(t||S(),T.schedule(E,b,R)),c},{}),cancel:c=>{for(let u=0;u<f.length;u++)o[f[u]].cancel(c)},state:i,steps:o}}const{schedule:z,cancel:Y,state:V,steps:k}=j(typeof requestAnimationFrame<"u"?requestAnimationFrame:q,!0);let m;function B(){m=void 0}const v={now:()=>(m===void 0&&v.set(V.isProcessing||F.useManualTiming?V.timestamp:performance.now()),m),set:s=>{m=s,queueMicrotask(B)}},M=30,K=s=>!isNaN(parseFloat(s)),C={current:void 0};class W{constructor(e,t={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=n=>{const i=v.now();if(this.updatedAt!==i&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(n),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const a of this.dependents)a.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=t.owner}setCurrent(e){this.current=e,this.updatedAt=v.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=K(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,t){this.events[e]||(this.events[e]=new D);const n=this.events[e].add(t);return e==="change"?()=>{n(),z.read(()=>{this.events.change.getSize()||this.stop()})}:n}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,t){this.passiveEffect=e,this.stopPassiveEffect=t}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,t,n){this.set(t),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-n}jump(e,t=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,t&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return C.current&&C.current.push(this),this.current}getPrevious(){return this.prev}getVelocity(){const e=v.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>M)return 0;const t=Math.min(this.updatedAt-this.prevUpdatedAt,M);return L(parseFloat(this.current)-parseFloat(this.prevFrameValue),t)}start(e){return this.stop(),new Promise(t=>{this.hasAnimated=!0,this.animation=e(t),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function H(s,e){return new W(s,e)}export{W as M,D as S,V as a,C as b,Y as c,f as d,U as e,z as f,k as g,X as h,j as i,H as m,q as n,x as r,w as s,v as t,L as v};
